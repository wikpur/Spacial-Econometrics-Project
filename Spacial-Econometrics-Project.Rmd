---
title: ""
date: "`r Sys.Date()`"
output:
  rmdformats::downcute:
    self_contained: true
    default_style: "light"
    downcute_theme: "default"
---

```{r setup, include=FALSE}
## Global options
knitr::opts_chunk$set(cache = TRUE)
```


# *Spatial Trends in Property Crimes: A Focus on crimes against property across Poland's  Pomeranian voivodeship*

## INTRODUCTION

The study aims to analyze spatial trends in property crimes, in Poland in regards to the Pomeranian voivodeship and itâ€™s counties. Further examination explores how socio-economic factors---like unemployment rate, social services, average gross monthly salary, population density and international migrations --- affect crime rates, considering geographic contexts. The study takes data from 2018.

## I. DATA DESCRIPTION

The database comprises data on the number of ascertained crimes in 2018 across Poland's Pomeranian voivodeship and it's counties.

**Crime ascertained** is a crime concluded with confirmation of the occurrence of the prohibited act.

The database contain only the crimes committed by an adult.

[Note:]{.underline} Polish law indicates that theft with a value not exceeding 500 PLN is considered a misdemeanor, not a crime. Reporting such theft will not be considered or processed, so there is no point in reporting them. Such a situation causes a disturbance between the actual amount of thefts and the recorded ones, since people has no incentive to report a theft under 500 PLN. This aspect was taken into consideration during the examination.

## II. DATA VISUALIZATION

```{r}
install.packages(sf)
install.packages(rgugik)
install.packages(bdl)
install.packages(elevatr)
install.packages(terra)
install.packages("ggplot2")
install.packages("tidyverse")

```

```{r}
Sys.setenv("PROJ_NETWORK"="ON")
library(rgugik)
library(sf)
library(bdl)
```

### POPULATION DENSITY 

It is assumed that the number of crimes committed is directly proportional to the population density of cities, meaning we expect a greater number of thefts in larger urban areas.

### POVERTY RATE

A direct proportional relationship between poverty rate and crimes of theft is assumed (the higher rate of poverty, the higher amount of crimes of theft)

### AVERAGE GROSS MONTHLY SALARY 

An inverse relationship between average gross monthly salary and crimes of theft is assumed (the higher amount of average gross monthly salary, the lower amount of crimes of theft).

### UNEMPLOYMENT RATE

We assume that there is direct proportional relationship between unemployment rate and crimes of theft (the higher rate of unemployment, the higher amount of crimes of theft).

```{r}
Sys.setenv("PROJ_NETWORK"="ON")
library(rgugik)
library(sf)
substring(county_names$TERYT, 1, 2) -> vpom
county_names |> subset(subset = vpom == "22") -> pom0
```

```{r}
borders_get(TERYT = pom0$TERYT) -> pom
ID <- as.integer("0012345") 
str(ID)
formatC(ID, format="d", width=7, flag="0")
dim(pom)
pom |> sapply(class) |> str()
str(pom$TERYT)
str(pom0)
```
```{r}
pom$TERYT <- sub("_", "", pom$TERYT)
any(is.na(match(pom$TERYT, pom0$TERYT)))


## ----pl_m3, size="footnotesize"-----------------------------------------------
pom |> merge(pom0, by = "TERYT") -> pom1 
pom1
```
```{r}
unemp <- readxl::read_excel("Bezrobocie.xlsx")
sapply(unemp, class)
names(unemp)
pom1 |> merge(unemp, by.x = "TERYT",
 by.y = "Kod") -> pom2
pom2
pom2 |> merge(unemp, by.x = "NAME",
 by.y = "County") -> pom3
pom3
```

```{r}
library(mapview)
mapview(pom3, zcol="Unemployment.x")
```

```{r}
install.packages("giscoR")
library(giscoR)
pom_gisco <- gisco_get_nuts(year="2021", resolution="01",
 spatialtype="RG", nuts_id="PL63")
pom_gisco_tm <- st_transform(pom_gisco, "EPSG:2180")
pom4 <- st_intersection(pom3, pom_gisco_tm)
```
```{r}
pom3 |> st_geometry_type() |> table() -> tab5; tab5[tab5>0]
```
```{r}
pom4 |> st_geometry_type() |> table() -> tab6; tab6[tab6>0]
```
```{r}
pom4 |> st_cast("MULTIPOLYGON") -> pom4
```

```{r}
mapview(pom4, zcol="Unemployment.x")
```

```{r}
plot(density(pom4$Unemployment.x))
```

```{r}
install.packages("mapsf")
library(mapsf)
mapsf::mf_map(pom4, var="Unemployment.x", type="choro", breaks="geom",
 nbreaks=7)
```


```{r}
fn <- paste0(io_dir, "/pom4.gpkg")
if (file.exists(fn)) tull <- file.remove(fn)
try(st_write(pom4, fn))
``` 

